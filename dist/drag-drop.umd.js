var We=Object.defineProperty;var O=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var P=(m,p,y)=>p in m?We(m,p,{enumerable:!0,configurable:!0,writable:!0,value:y}):m[p]=y,L=(m,p)=>{for(var y in p||(p={}))Ge.call(p,y)&&P(m,y,p[y]);if(O)for(var y of O(p))Re.call(p,y)&&P(m,y,p[y]);return m};(function(m,p){typeof exports=="object"&&typeof module!="undefined"?module.exports=p():typeof define=="function"&&define.amd?define(p):(m=typeof globalThis!="undefined"?globalThis:m||self,m.dragDrop=p())})(this,function(){"use strict";var m=p;function p(t){let n=!1,e;return t?(e=F(t),n=!0):e=y(),e.timeout=N(n,e),e}function y(){let t,n;const e=new Promise((i,r)=>{t=i,n=r});return{promise:e,done:t,cancel:n,onComplete:w(e)}}function F(t){let n=t.map(i=>y()),e=n.map(i=>i.promise);return n.promises=e,n.onComplete=w(Promise.all(e)),n}function w(t){return function(n){t.then(e=>n(e))}}function N(t,n){let e;return t?e=Promise.all(n.promises):e=n.promise,function(i,r){let o,s=new Promise((c,a)=>{o=setTimeout(()=>{c(r),Promise.resolve(e)},i)});return e.then(()=>clearTimeout(o)),n.onComplete=w(Promise.race([e,s])),n}}function Y(){return function(t,n){let e={},i={},r={};return t.forEach(o=>{const[s,c,a,d,l]=o,g=n[d],h=`${s}/${c}`;e[h]=g||null,i[h]=a,X(l)&&(r[h]=[],r[h][0]=l[0],r[h][1]=l[1])}),{transitions:e,nextState:i,chainActions:r}}}function X(t){return!(t instanceof Array)||t.length!=2?!1:(t.forEach(n=>{if(n!==!1||typeof n!="string")return!1}),!0)}var A=Y;function I(t){return function(n,e,i){const r=t.askForPromise(),o=`${t.state}/${e}`,s=t.callback;t.lock=!0,t._transit(r,o,i),r.onComplete(c=>{let a=t._getChain(t.chainActions,o),d=c.response;if(c.success){if(t.state=t.nextState[o],c.stateData&&(t.stateData=c.stateData),s.positive.forEach(l=>l(t.state,d)),s.transition.forEach(l=>l(t.state,d)),a&&a[0]){t._updateStep(n,a[0],d);return}}else if(s.negative.forEach(l=>l(t.state,d)),s.transition.forEach(l=>l(t.state,d)),a&&a[1]){t._updateStep(n,a[1],d);return}if(c.command){t._updateStep(n,c.command,d);return}n.done(d)}),r.promise.catch(()=>console.log(`Failed in step ${o}`))}}var K=I;function j(t){return function(n){Object.keys(n).forEach(e=>{n[e]==null&&console.log(`Warning: Transition for ${e} is not defined`)})}}var q=j;function z(t){return function(n,e,i){const r=t.dependencies,o=L({},t.stateData),s=t.transitions[e];typeof s=="function"?s(n,r,o,i):n.done({success:!1})}}var B=z;function H(){return function(t,n){return t[n]?t[n]:!1}}var W=H;function G(t){return function(){if(t.cache.length!==0){const{updateTask:n,action:e,dt:i}=t.cache[0];t.cache=t.cache.reduce((r,o,s)=>(s!=0&&r.push(o),r),[]),t._updateStep(n,e,i),n.onComplete(r=>t._onUpdateTask(r))}}}var R=G;function V(t){return function(e){const i=t.callback,r=t.askForPromise(i.update);i.update.forEach((o,s)=>{o(t.state,e),r[s].done()}),r.onComplete(o=>{t.lock=!1,t._triggerCacheUpdate()})}}var J=V;function Q(t){return function(n){t.dependencies=L(L({},t.dependencies),n)}}var ee=Q;function te(t){return function(n,e){const i=t.callback;i[n]&&i[n].push(e)}}var ne=te;function re(t){return function(n){!t.callback[n]||(t.callback[n]=[])}}var oe=re;function ie(t){return function({state:n,stateData:e}){n&&(t.state=n,t.stateData=L({},e))}}var se=ie;function ce(t){return function(){const n=t.state,e=L({},t.stateData);return{state:n,stateData:e}}}var ae=ce;function de(t){return function(n,e){const i=t.askForPromise();return t.lock?(t.cache.push({updateTask:i,action:n,dt:e}),i.promise):(t._updateStep(i,n,e),i.onComplete(r=>t._onUpdateTask(r)),i.promise)}}var le=de;function ue(t){return function(){t.state=t.initialState,t.stateData=t.initialStateData}}var fe=ue;function pe(t){return function(){t.cache.forEach(({updateTask:e,action:i,dt:r})=>e.cancel(`Action '${i}' was ignored`)),t.cache=[]}}var ge=pe;function he(t){return function(){return t.state}}var me=he,ye={_setTransitions:A,_updateStep:K,_warn:q,_transit:B,_getChain:W,_triggerCacheUpdate:R,_onUpdateTask:J,setDependencies:ee,on:ne,off:oe,importState:se,exportState:ae,update:le,reset:fe,ignoreCachedUpdates:ge,getState:me};const $="N/A",ve=m,k=ye;function Se({init:t,table:n,stateData:e,debug:i},r={}){const o=this,s=Object.keys(k);o.state=t||$,o.initialState=t||$,o.lock=!1,o.cache=[],o.askForPromise=ve,o.stateData=L({},e),o.initialStateData=L({},e),o.dependencies={},o.callback={update:[],transition:[],positive:[],negative:[]},s.forEach(l=>o[l]=k[l](o));const{transitions:c,nextState:a,chainActions:d}=o._setTransitions(n,r);i&&o._warn(c),o.transitions=c,o.nextState=a,o.chainActions=d}var _e=Se;function Ee({startX:t,startY:n,newX:e,newY:i}){let r=Math.min(t,e),o=Math.max(t,e),s=Math.min(n,i),c=Math.max(n,i);return{xMin:r,xMax:o,yMin:s,yMax:c}}function Le(t,n){const{xMin:e,xMax:i,yMin:r,yMax:o}=t;n.style.left=`${e}px`,n.style.top=`${r}px`,n.style.width=`${i-e}px`,n.style.height=`${o-r}px`}function xe(t,n){let e;return n?(e=n,e.style.visibility="visible"):(e=document.createElement("div"),e.style.position="absolute",e.style.border="1px dotted #333",document.getElementsByTagName("body")[0].appendChild(e)),e.style.left=`${t.clientX}px`,e.style.top=`${t.clientY}px`,e.style.width="20px",e.style.height="20px",e}function be(t){return function(){let e=document.querySelectorAll("[draggable]"),i=[];return e.forEach(r=>{r.parentNode==t&&i.push(r)}),i}}function T(t,n){return t===document||t.tagName=="BODY"?!1:t.classList.contains(n)?t:T(t.parentNode,n)}function Z(t,n){return{mouseDown:e=>{e.target.draggable||n&&n(e)||t.update("select",{event:e})},mouseUp:e=>{if(e.target.draggable){e.altKey?t.update("removeItem",{event:e}):e.shiftKey?t.update("addItem",{event:e}):t.update("newSelection",{event:e});return}t.update("end",{event:e})},mouseMove:e=>t.update("move",{event:e}),dragStart:e=>t.update("drag",{event:e}),dragEnd:e=>{t.ignoreCachedUpdates(),t.update("end",{event:e})},dragOver:e=>e.preventDefault(),dragEnter:e=>t.update("move",{event:e}),drop:e=>t.update("drop",{event:e})}}const we={minMax:Ee,updateSelection:Le,drawSelection:xe,targetList:be,findDropZone:T,getEventFunctions:Z};function Ce({event:t,dropZone:n,dragged:e,selection:i,log:r,dragOffset:o}){i.forEach(s=>{s.parentNode.removeChild(s),n.appendChild(s)}),e.style=""}function $e({event:t,selection:n,draggedTransperency:e,selectStyle:i}){n.forEach(r=>{r.style.opacity=e,r.classList.add(i)})}function ke({event:t,dropZone:n,dragged:e,selection:i,log:r,dragOffset:o}){console.log("DROP OUT")}const D={onDrop:Ce,onStartDragging:$e,onDropOut:ke},Te={init:"none",table:[["none","start","wait","setConfig",["start",!1]],["wait","start","ready","start"],["ready","addItem","ready","addSingleItem"],["ready","newSelection","ready","replaceSelection"],["ready","removeItem","ready","removeSingleItem"],["ready","select","inSelect","startSelection"],["inSelect","move","inSelect","changeSelection"],["inSelect","end","ready","endSelection"],["ready","drag","inDrag","startDragging"],["inDrag","end","ready","endDragging"],["inDrag","move","inDrag","changeDragZone"],["inDrag","drop","inDrag","drop"],["ready","disable","off","disable"],["off","enable","ready","enable"],["off","changeConfig","off","setConfig"],["ready","changeConfig","ready","setConfig"],["ready","destroy","end","destroy"],["off","destroy","end","destroy"]],stateData:{dropStyle:"dropzone",selectStyle:"dd-select",filter:!1,draggedTransperency:.5,selection:[],dragged:null,activeDropZone:null,activeZoneStyle:"actZone",selectDraw:null,mouseSelection:!1,hasDrop:!1,dragOffset:null,startX:0,startY:0,newX:!1,newY:!1}};function Ze(t,n,e,i){let{eFn:r}=n;document.addEventListener("mousedown",r.mouseDown),document.addEventListener("mousemove",r.mouseMove),document.addEventListener("mouseup",r.mouseUp),document.addEventListener("dragstart",r.dragStart),document.addEventListener("dragend",r.dragEnd),document.addEventListener("dragover",r.dragOver),document.addEventListener("dragenter",r.dragEnter),document.addEventListener("drop",r.drop),t.done({success:!0,response:i})}function De(t,n,e,i){const{event:r}=i,{fn:o}=n,{selectDraw:s}=e;r.preventDefault(),e.selectDraw=o.drawSelection(r,s),e.mouseSelection=!0,e.startX=r.clientX,e.startY=r.clientY,t.done({success:!0,stateData:e})}function Me(t,n,e,i){let{mouseSelection:r,selectDraw:o,startX:s,startY:c}=e,{event:a}=i,{fn:d}=n;if(!r){t.done({success:!1});return}a.preventDefault();let l=a.clientX,g=a.clientY;d.updateSelection(d.minMax({startX:s,startY:c,newX:l,newY:g}),o),e.newX=l,e.newY=g,t.done({success:!0,stateData:e})}function Ue(t,n,e,i){let{event:r}=i,{fn:o}=n,{startX:s,startY:c,newX:a,newY:d,selectDraw:l,selectStyle:g,filter:h}=e,_=[],v="new";if(r.preventDefault(),l.style.visibility="hidden",!a){e.selection.forEach(u=>u.classList.remove(g)),e.selection=[],t.done({success:!0,stateData:e});return}r.altKey&&(v="reduce"),r.shiftKey&&(v="expand"),v!=="expand"&&e.selection.forEach(u=>u.classList.remove(g));let{xMin:S,xMax:E,yMin:x,yMax:b}=o.minMax({startX:s,startY:c,newX:a,newY:d}),U=document.querySelectorAll("[draggable]"),C=[];switch(h?U.forEach(u=>{u.classList.contains(h)&&C.push(u)}):U.forEach(u=>C.push(u)),C.forEach(u=>{let f=!0;f&&(f=u.offsetLeft>S),f&&(f=u.offsetTop>x),f&&(f=u.offsetLeft+u.clientWidth<E),f&&(f=u.offsetTop+u.clientHeight<b),f&&_.push(u)}),v){case"new":e.selection=_.map(u=>(u.classList.add(g),u));break;case"expand":e.selection=_.reduce((u,f)=>(u.includes(f)||(u.push(f),f.classList.add(g)),u),e.selection);break;case"reduce":e.selection=e.selection.reduce((u,f)=>(_.includes(f)||(u.push(f),f.classList.add(g)),u),[]);break}e.mouseSelection=!1,e.newX=!1,e.newY=!1,t.done({success:!0,stateData:e})}function Oe(t,n,e,i){let{event:r}=i,o=r.target,{selection:s,selectStyle:c,filter:a}=e,d=s.includes(o),l=!0;a&&(l=o.classList.contains(a)),!d&&l&&(s.push(o),o.classList.add(c)),t.done({success:!0,stateData:e})}function Pe(t,n,e,i){let{event:r}=i,o=r.target,{selection:s,selectStyle:c}=e;e.selection=s.reduce((a,d)=>(d!=o?a.push(d):d.classList.remove(c),a),[]),t.done({success:!0,stateData:e})}function Fe(t,n,e,i){let{event:r}=i,{selectStyle:o,filter:s}=e,c=r.target,a=!0;if(s&&(a=c.classList.contains(s)),!a){t.done({success:!1});return}e.selection.forEach(d=>d.classList.remove(o)),c.classList.add(o),e.selection=[c],t.done({success:!0,stateData:e})}function Ne(t,n,e,i){let{event:r}=i,{target:o}=r,{draggedTransperency:s,selection:c,selectStyle:a,dropStyle:d,filter:l,dependencies:g}=e,{hooks:h,fn:_}=n,v=!0;if(l&&(v=o.classList.contains(l)),!v){t.done({success:!1});return}c.length===0&&(c=[o]),h.onStartDragging({event:r,selection:c,draggedTransperency:s,selectStyle:a,dependencies:g}),e.dragged=o,e.dragOffset={x:r.offsetX,y:r.offsetY},e.selection=c,e.activeDropZone=_.findDropZone(o,d),t.done({success:!0,stateData:e})}function Ye(t,n,e,i){let{event:r}=i,{fn:o}=n,{activeDropZone:s,dragged:c,activeZoneStyle:a,dropStyle:d}=e,l=!1;if(c.parentNode===r.target.parentNode){t.done({success:!0});return}if(l=o.findDropZone(r.target,d),!l){t.done({success:!1});return}if(l){s&&s.classList.remove(a),l.classList.add(a),e.activeDropZone=l,t.done({success:!0,stateData:e});return}t.done({success:!1})}function Xe(t,n,e,i){let{hooks:r,fn:o}=n,{activeDropZone:s,activeZoneStyle:c,dragged:a,selection:d,selectStyle:l,hasDrop:g,dependencies:h}=e,{event:_}=i,v=[];if(!g){let S=!1;d.forEach(E=>{let x=o.targetList(E.parentNode),b={source:E.parentNode,target:!1,el:E,sourceList:x};v.push(b)}),r.onDropOut({event:_,dropZone:S,dragged:a,selection:d,log:v,dependencies:h})}s.classList.remove(c),d.forEach(S=>{S.classList.remove(l),S.style.opacity="",S.style[0]||S.removeAttribute("style")}),e.activeDropZone=null,e.selection=[],e.hasDrop=!1,t.done({success:!0,stateData:e})}function Ae(t,n,e,i){let{event:r}=i,{activeDropZone:o,dragged:s,selection:c,dropStyle:a,dragOffset:d,dependencies:l}=e,{hooks:g,fn:h}=n,_=[],v=h.targetList(r.target),S=h.findDropZone(r.target,a);r.preventDefault(),S==o&&(c.forEach(E=>{let x=h.targetList(E.parentNode),b={source:E.parentNode,target:S,el:E,targetList:v,sourceList:x};_.push(b)}),g.onDrop({event:r,dropZone:S,dragged:s,selection:c,log:_,dragOffset:d,dependencies:l}),e.hasDrop=!0),e.dragOffset=null,t.done({success:!0,stateData:e})}function Ie(t,n,e,i){let{eFn:r}=n;document.removeEventListener("mousedown",r.mouseDown),document.removeEventListener("mousemove",r.mouseMove),document.removeEventListener("mouseup",r.mouseUp),document.removeEventListener("dragstart",r.dragStart),document.removeEventListener("dragend",r.dragEnd),document.removeEventListener("dragover",r.dragOver),document.removeEventListener("dragenter",r.dragEnter),document.removeEventListener("drop",r.drop),t.done({success:!0})}function Ke(t,n,e,i={}){let{hooks:r,config:o}=i;r||(r={}),o||(o={}),o.onStartDragging&&(r.onStartDragging=o.onStartDragging),o.onDrop&&(r.onDrop=o.onDrop),o.onDropOut&&(r.onDropOut=o.onDropOut),o.dropStyle&&typeof o.dropStyle=="string"&&(e.dropStyle=o.dropStyle),o.draggedTransperency&&typeof o.draggedTransperency=="number"&&(e.draggedTransperency=o.draggedTransperency),o.activeZoneStyle&&typeof o.activeZoneStyle=="string"&&(e.activeZoneStyle=o.activeZoneStyle),o.selectStyle&&typeof o.selectStyle=="string"&&(e.selectStyle=o.selectStyle),o.filter&&typeof o.filter=="string"&&(e.filter=o.filter),o.dependencies?e.dependencies=o.dependencies:e.dependencies={},t.done({success:!0,stateData:e,response:r})}function je(t,n,e,i){t.done({success:!0})}function qe(t,n,e,i){t.don({success:!0})}const ze={start:Ze,startSelection:De,changeSelection:Me,endSelection:Ue,addSingleItem:Oe,removeSingleItem:Pe,replaceSelection:Fe,startDragging:Ne,changeDragZone:Ye,endDragging:Xe,drop:Ae,destroy:Ie,setConfig:Ke,disable:je,enable:qe};function M(t={}){const n=new _e(Te,ze),e=Z(n,t.ignoreSelect),i=n.askForPromise;return n.setDependencies({eFn:e,fn:we,askForPromise:i}),n.update("start",{config:t,hooks:D}).then(r=>n.setDependencies({hooks:r})).then(()=>({changeConfig:r=>{n.update("changeConfig",{hooks:D,config:r}).then(o=>n.setDependencies({hooks:o}))},destroy:()=>n.update("destroy"),disable:()=>n.update("disable"),enable:()=>n.update("enable")}))}function Be(){console.log("injected")}return M({ignoreSelect(t){return!t.target.classList.contains("dropzone")},onDropOut({event:t,dropZone:n,dragged:e,selection:i,log:r,dragOffset:o,dependencies:s}){console.log("YES drop out"),s.yok()},dependencies:{yok:Be}}),M});
