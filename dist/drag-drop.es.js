var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,s=(e,s)=>{for(var r in s||(s={}))n.call(s,r)&&a(e,r,s[r]);if(t)for(var r of t(s))o.call(s,r)&&a(e,r,s[r]);return e};function r(){let e,t;const n=new Promise(((n,o)=>{e=n,t=o}));return{promise:n,done:e,cancel:t,onComplete:c(n)}}function c(e){return function(t){e.then((e=>t(e)))}}const i=function(e){let t,n=!1;e?(t=function(e){let t=e.map((e=>r())),n=t.map((e=>e.promise));return t.promises=n,t.onComplete=c(Promise.all(n)),t}(e),n=!0):t=r();return t.timeout=function(e,t){let n;n=e?Promise.all(t.promises):t.promise;return function(e,o){let a,s=new Promise(((t,s)=>{a=setTimeout((()=>{t(o),Promise.resolve(n)}),e)}));return n.then((()=>clearTimeout(a))),t.onComplete=c(Promise.race([n,s])),t}}(n,t),t},d={_setTransitions:function(){return function(e,t){let n={},o={},a={};return e.forEach((e=>{const[s,r,c,i,d]=e,l=t[i],u=`${s}/${r}`;n[u]=l||null,o[u]=c,function(e){return e instanceof Array&&(2==e.length&&(e.forEach((e=>{if(!1!==e||"string"!=typeof e)return!1})),!0))}(d)&&(a[u]=[],a[u][0]=d[0],a[u][1]=d[1])})),{transitions:n,nextState:o,chainActions:a}}},_updateStep:function(e){return function(t,n,o){const a=e.askForPromise(),s=`${e.state}/${n}`,r=e.callback;e.lock=!0,e._transit(a,s,o),a.onComplete((n=>{let o=e._getChain(e.chainActions,s),a=n.response;if(n.success){if(e.state=e.nextState[s],n.stateData&&(e.stateData=n.stateData),r.positive.forEach((t=>t(e.state,a))),r.transition.forEach((t=>t(e.state,a))),o&&o[0])return void e._updateStep(t,o[0],a)}else if(r.negative.forEach((t=>t(e.state,a))),r.transition.forEach((t=>t(e.state,a))),o&&o[1])return void e._updateStep(t,o[1],a);n.command?e._updateStep(t,n.command,a):t.done(a)})),a.promise.catch((()=>console.log(`Failed in step ${s}`)))}},_warn:function(e){return function(e){Object.keys(e).forEach((t=>{null==e[t]&&console.log(`Warning: Transition for ${t} is not defined`)}))}},_transit:function(e){return function(t,n,o){const a=e.dependencies,r=s({},e.stateData),c=e.transitions[n];"function"==typeof c?c(t,a,r,o):t.done({success:!1})}},_getChain:function(){return function(e,t){return!!e[t]&&e[t]}},_triggerCacheUpdate:function(e){return function(){if(0!==e.cache.length){const{updateTask:t,action:n,dt:o}=e.cache[0];e.cache=e.cache.reduce(((e,t,n)=>(0!=n&&e.push(t),e)),[]),e._updateStep(t,n,o),t.onComplete((t=>e._onUpdateTask(t)))}}},_onUpdateTask:function(e){return function(t){const n=e.callback,o=e.askForPromise(n.update);n.update.forEach(((n,a)=>{n(e.state,t),o[a].done()})),o.onComplete((t=>{e.lock=!1,e._triggerCacheUpdate()}))}},setDependencies:function(e){return function(t){e.dependencies=s(s({},e.dependencies),t)}},on:function(e){return function(t,n){const o=e.callback;o[t]&&o[t].push(n)}},off:function(e){return function(t){e.callback[t]&&(e.callback[t]=[])}},importState:function(e){return function({state:t,stateData:n}){t&&(e.state=t,e.stateData=s({},n))}},exportState:function(e){return function(){return{state:e.state,stateData:s({},e.stateData)}}},update:function(e){return function(t,n){const o=e.askForPromise();return e.lock?(e.cache.push({updateTask:o,action:t,dt:n}),o.promise):(e._updateStep(o,t,n),o.onComplete((t=>e._onUpdateTask(t))),o.promise)}},reset:function(e){return function(){e.state=e.initialState,e.stateData=e.initialStateData}},ignoreCachedUpdates:function(e){return function(){e.cache.forEach((({updateTask:e,action:t,dt:n})=>e.cancel(`Action '${t}' was ignored`))),e.cache=[]}},getState:function(e){return function(){return e.state}}};var l=function({init:e,table:t,stateData:n,debug:o},a={}){const r=this,c=Object.keys(d);r.state=e||"N/A",r.initialState=e||"N/A",r.lock=!1,r.cache=[],r.askForPromise=i,r.stateData=s({},n),r.initialStateData=s({},n),r.dependencies={},r.callback={update:[],transition:[],positive:[],negative:[]},c.forEach((e=>r[e]=d[e](r)));const{transitions:l,nextState:u,chainActions:p}=r._setTransitions(t,a);o&&r._warn(l),r.transitions=l,r.nextState=u,r.chainActions=p};function u(e,t){return{mouseDown:n=>{n.target.draggable||t&&t(n)||e.update("select",{event:n})},mouseUp:t=>{t.target.draggable?t.altKey?e.update("removeItem",{event:t}):t.shiftKey?e.update("addItem",{event:t}):e.update("newSelection",{event:t}):e.update("end",{event:t})},mouseMove:t=>e.update("move",{event:t}),dragStart:t=>e.update("drag",{event:t}),dragEnd:t=>{e.ignoreCachedUpdates(),e.update("end",{event:t})},dragOver:e=>e.preventDefault(),dragEnter:t=>e.update("move",{event:t}),drop:t=>e.update("drop",{event:t})}}const p={minMax:function({startX:e,startY:t,newX:n,newY:o}){return{xMin:Math.min(e,n),xMax:Math.max(e,n),yMin:Math.min(t,o),yMax:Math.max(t,o)}},updateSelection:function(e,t){const{xMin:n,xMax:o,yMin:a,yMax:s}=e;t.style.left=`${n}px`,t.style.top=`${a}px`,t.style.width=o-n+"px",t.style.height=s-a+"px"},drawSelection:function(e,t){let n;return t?(n=t,n.style.visibility="visible"):(n=document.createElement("div"),n.style.position="absolute",n.style.border="1px dotted #333",document.getElementsByTagName("body")[0].appendChild(n)),n.style.left=`${e.clientX}px`,n.style.top=`${e.clientY}px`,n.style.width="20px",n.style.height="20px",n},targetList:function(e){return function(){let t=document.querySelectorAll("[draggable]"),n=[];return t.forEach((t=>{t.parentNode==e&&n.push(t)})),n}},findDropZone:function e(t,n){return t!==document&&("BODY"!=t.tagName&&(t.classList.contains(n)?t:e(t.parentNode,n)))},getEventFunctions:u};const f={onDrop:function({event:e,dropZone:t,dragged:n,selection:o,log:a,dragOffset:s}){o.forEach((e=>{e.parentNode.removeChild(e),t.appendChild(e)})),n.style=""},onStartDragging:function({event:e,selection:t,draggedTransperency:n,selectStyle:o}){t.forEach((e=>{e.style.opacity=n,e.classList.add(o)}))},onDropOut:function({event:e,dropZone:t,dragged:n,selection:o,log:a,dragOffset:s}){console.log("DROP OUT")}},g={init:"none",table:[["none","start","wait","setConfig",["start",!1]],["wait","start","ready","start"],["ready","addItem","ready","addSingleItem"],["ready","newSelection","ready","replaceSelection"],["ready","removeItem","ready","removeSingleItem"],["ready","select","inSelect","startSelection"],["inSelect","move","inSelect","changeSelection"],["inSelect","end","ready","endSelection"],["ready","drag","inDrag","startDragging"],["inDrag","end","ready","endDragging"],["inDrag","move","inDrag","changeDragZone"],["inDrag","drop","inDrag","drop"],["ready","disable","off","disable"],["off","enable","ready","enable"],["off","changeConfig","off","setConfig"],["ready","changeConfig","ready","setConfig"],["ready","destroy","end","destroy"],["off","destroy","end","destroy"]],stateData:{dropStyle:"dropzone",selectStyle:"dd-select",filter:!1,draggedTransperency:.5,selection:[],dragged:null,activeDropZone:null,activeZoneStyle:"actZone",selectDraw:null,mouseSelection:!1,hasDrop:!1,dragOffset:null,startX:0,startY:0,newX:!1,newY:!1}};const m={start:function(e,t,n,o){let{eFn:a}=t;document.addEventListener("mousedown",a.mouseDown),document.addEventListener("mousemove",a.mouseMove),document.addEventListener("mouseup",a.mouseUp),document.addEventListener("dragstart",a.dragStart),document.addEventListener("dragend",a.dragEnd),document.addEventListener("dragover",a.dragOver),document.addEventListener("dragenter",a.dragEnter),document.addEventListener("drop",a.drop),e.done({success:!0,response:o})},startSelection:function(e,t,n,o){const{event:a}=o,{fn:s}=t,{selectDraw:r}=n;a.preventDefault(),n.selectDraw=s.drawSelection(a,r),n.mouseSelection=!0,n.startX=a.clientX,n.startY=a.clientY,e.done({success:!0,stateData:n})},changeSelection:function(e,t,n,o){let{mouseSelection:a,selectDraw:s,startX:r,startY:c}=n,{event:i}=o,{fn:d}=t;if(!a)return void e.done({success:!1});i.preventDefault();let l=i.clientX,u=i.clientY;d.updateSelection(d.minMax({startX:r,startY:c,newX:l,newY:u}),s),n.newX=l,n.newY=u,e.done({success:!0,stateData:n})},endSelection:function(e,t,n,o){let{event:a}=o,{fn:s}=t,{startX:r,startY:c,newX:i,newY:d,selectDraw:l,selectStyle:u,filter:p}=n,f=[],g="new";if(a.preventDefault(),l.style.visibility="hidden",!i)return n.selection.forEach((e=>e.classList.remove(u))),n.selection=[],void e.done({success:!0,stateData:n});a.altKey&&(g="reduce"),a.shiftKey&&(g="expand"),"expand"!==g&&n.selection.forEach((e=>e.classList.remove(u)));let{xMin:m,xMax:v,yMin:y,yMax:h}=s.minMax({startX:r,startY:c,newX:i,newY:d}),D=document.querySelectorAll("[draggable]"),S=[];switch(p?D.forEach((e=>{e.classList.contains(p)&&S.push(e)})):D.forEach((e=>S.push(e))),S.forEach((e=>{let t=!0;if(t&&(t=e.offsetLeft>m),t&&(t=e.offsetTop>y),t){t=e.offsetLeft+e.clientWidth<v}if(t){t=e.offsetTop+e.clientHeight<h}t&&f.push(e)})),g){case"new":n.selection=f.map((e=>(e.classList.add(u),e)));break;case"expand":n.selection=f.reduce(((e,t)=>(e.includes(t)||(e.push(t),t.classList.add(u)),e)),n.selection);break;case"reduce":n.selection=n.selection.reduce(((e,t)=>(f.includes(t)||(e.push(t),t.classList.add(u)),e)),[])}n.mouseSelection=!1,n.newX=!1,n.newY=!1,e.done({success:!0,stateData:n})},addSingleItem:function(e,t,n,o){let{event:a}=o,s=a.target,{selection:r,selectStyle:c,filter:i}=n,d=r.includes(s),l=!0;i&&(l=s.classList.contains(i)),!d&&l&&(r.push(s),s.classList.add(c)),e.done({success:!0,stateData:n})},removeSingleItem:function(e,t,n,o){let{event:a}=o,s=a.target,{selection:r,selectStyle:c}=n;n.selection=r.reduce(((e,t)=>(t!=s?e.push(t):t.classList.remove(c),e)),[]),e.done({success:!0,stateData:n})},replaceSelection:function(e,t,n,o){let{event:a}=o,{selectStyle:s,filter:r}=n,c=a.target,i=!0;r&&(i=c.classList.contains(r)),i?(n.selection.forEach((e=>e.classList.remove(s))),c.classList.add(s),n.selection=[c],e.done({success:!0,stateData:n})):e.done({success:!1})},startDragging:function(e,t,n,o){let{event:a}=o,{target:s}=a,{draggedTransperency:r,selection:c,selectStyle:i,dropStyle:d,filter:l}=n,{hooks:u,fn:p}=t,f=!0;l&&(f=s.classList.contains(l)),f?(0===c.length&&(c=[s]),u.onStartDragging({event:a,selection:c,draggedTransperency:r,selectStyle:i}),n.dragged=s,n.dragOffset={x:a.offsetX,y:a.offsetY},n.selection=c,n.activeDropZone=p.findDropZone(s,d),e.done({success:!0,stateData:n})):e.done({success:!1})},changeDragZone:function(e,t,n,o){let{event:a}=o,{fn:s}=t,{activeDropZone:r,dragged:c,activeZoneStyle:i,dropStyle:d}=n,l=!1;if(c.parentNode!==a.target.parentNode){if(l=s.findDropZone(a.target,d),l)return l?(r&&r.classList.remove(i),l.classList.add(i),n.activeDropZone=l,void e.done({success:!0,stateData:n})):void e.done({success:!1});e.done({success:!1})}else e.done({success:!0})},endDragging:function(e,t,n,o){let{hooks:a,fn:s}=t,{activeDropZone:r,activeZoneStyle:c,dragged:i,selection:d,selectStyle:l,hasDrop:u}=n,{event:p}=o,f=[];if(!u){let e=!1;d.forEach((e=>{let t=s.targetList(e.parentNode),n={source:e.parentNode,target:!1,el:e,sourceList:t};f.push(n)})),a.onDropOut({event:p,dropZone:e,dragged:i,selection:d,log:f})}r.classList.remove(c),d.forEach((e=>{e.classList.remove(l),e.style.opacity="",e.style[0]||e.removeAttribute("style")})),n.activeDropZone=null,n.selection=[],n.hasDrop=!1,e.done({success:!0,stateData:n})},drop:function(e,t,n,o){let{event:a}=o,{activeDropZone:s,dragged:r,selection:c,dropStyle:i,dragOffset:d}=n,{hooks:l,fn:u}=t,p=[],f=u.targetList(a.target),g=u.findDropZone(a.target,i);a.preventDefault(),g==s&&(c.forEach((e=>{let t=u.targetList(e.parentNode),n={source:e.parentNode,target:g,el:e,targetList:f,sourceList:t};p.push(n)})),l.onDrop({event:a,dropZone:g,dragged:r,selection:c,log:p,dragOffset:d}),n.hasDrop=!0),n.dragOffset=null,e.done({success:!0,stateData:n})},destroy:function(e,t,n,o){let{eFn:a}=t;document.removeEventListener("mousedown",a.mouseDown),document.removeEventListener("mousemove",a.mouseMove),document.removeEventListener("mouseup",a.mouseUp),document.removeEventListener("dragstart",a.dragStart),document.removeEventListener("dragend",a.dragEnd),document.removeEventListener("dragover",a.dragOver),document.removeEventListener("dragenter",a.dragEnter),document.removeEventListener("drop",a.drop),e.done({success:!0})},setConfig:function(e,t,n,o={}){let{hooks:a,config:s}=o;a||(a={}),s||(s={}),s.onStartDragging&&(a.onStartDragging=s.onStartDragging),s.onDrop&&(a.onDrop=s.onDrop),s.onDropOut&&(a.onDropOut=s.onDropOut),s.dropStyle&&"string"==typeof s.dropStyle&&(n.dropStyle=s.dropStyle),s.draggedTransperency&&"number"==typeof s.draggedTransperency&&(n.draggedTransperency=s.draggedTransperency),s.activeZoneStyle&&"string"==typeof s.activeZoneStyle&&(n.activeZoneStyle=s.activeZoneStyle),s.selectStyle&&"string"==typeof s.selectStyle&&(n.selectStyle=s.selectStyle),s.filter&&"string"==typeof s.filter&&(n.filter=s.filter),e.done({success:!0,stateData:n,response:a})},disable:function(e,t,n,o){e.done({success:!0})},enable:function(e,t,n,o){e.don({success:!0})}};function v(e={}){const t=new l(g,m),n=u(t,e.ignoreSelect),o=t.askForPromise;return t.setDependencies({eFn:n,fn:p,askForPromise:o}),t.update("start",{config:e,hooks:f}).then((e=>t.setDependencies({hooks:e}))).then((()=>({changeConfig:e=>{t.update("changeConfig",{hooks:f,config:e}).then((e=>t.setDependencies({hooks:e})))},destroy:()=>t.update("destroy"),disable:()=>t.update("disable"),enable:()=>t.update("enable")})))}export default v;
